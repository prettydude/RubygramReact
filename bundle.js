!function(e){function t(t){for(var r,o,i=t[0],s=t[1],u=t[2],f=0,d=[];f<i.length;f++)o=i[f],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&d.push(a[o][0]),a[o]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r]);for(l&&l(t);d.length;)d.shift()();return c.push.apply(c,u||[]),n()}function n(){for(var e,t=0;t<c.length;t++){for(var n=c[t],r=!0,i=1;i<n.length;i++){var s=n[i];0!==a[s]&&(r=!1)}r&&(c.splice(t--,1),e=o(o.s=n[0]))}return e}var r={},a={0:0},c=[];function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var i=window.webpackJsonp=window.webpackJsonp||[],s=i.push.bind(i);i.push=t,i=i.slice();for(var u=0;u<i.length;u++)t(i[u]);var l=s;c.push([231,1,2]),n()}({231:function(e,t,n){e.exports=n(811)},807:function(e,t,n){"use strict";n.r(t),t.default=n.p+"9803264ef4b7b0f35d6e3a1ada1a23d8.eot"},808:function(e,t,n){"use strict";n.r(t),t.default=n.p+"011728c439f3e40add3b0c9226854e51.ttf"},809:function(e,t,n){"use strict";n.r(t),t.default=n.p+"744f2f668c7b70be6c8078c5aeae4ec8.woff"},810:function(e,t,n){"use strict";n.r(t),t.default=n.p+"466c22542820d2193b1a8f4133677580.svg"},811:function(e,t,n){"use strict";n.r(t);n(232);var r=n(1),a=n(99),c=n.n(a),o=n(3),i=n(229),s=n(4),u=n(17),l=n.n(u),f=n(101),d=n(40),p=n(100),b=n.n(p),h=Object(d.b)({name:"interface",initialState:{darkMode:!1,deviseErrors:null,searchMode:!1,searchResults:[],contextMenuLocation:{x:0,y:0}},reducers:{setDarkMode:function(e,t){e.darkMode=t.payload},setDeviseErrors:function(e,t){e.deviseErrors=t.payload},clearDeviseErrors:function(e,t){e.deviseErrors=[]},setSearchMode:function(e,t){e.searchMode=t.payload},setSearchResults:function(e,t){e.searchResults=t.payload},resetSearchResults:function(e,t){e.searchResults=[]},setContextMenuLocation:function(e,t){e.contextMenuLocation=t.payload}}}),m=h.reducer,y=h.actions,v=(y.setDarkMode,y.setDeviseErrors),j=(y.clearDeviseErrors,y.setSearchMode),g=y.setSearchResults,O=(y.resetSearchResults,y.setContextMenuLocation),w=function(e){return e.interface.deviseErrors},x=function(e){return e.interface.searchMode},S=function(e){return e.interface.searchResults},k=function(e){return e.interface.contextMenuLocation};function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(Object(n),!0).forEach((function(t){P(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var N="https://rubygramreact.herokuapp.com/auth",_={authUrl:N,storage:window.localStorage,userAttributes:{email:"email",nickname:"nickname",name:"name",id:"id",provider:"provider",image:"image",avatar_url:"avatar_url"},userRegistrationAttributes:{nickname:"nickname",name:"name",image:"image"}};b.a.interceptors.response.use(null,(function(e){var t=e.response;return t&&t.config.url.startsWith(N)&&t.data.errors?(Ye.dispatch(v(t.data.errors)),Promise.reject(new Error("Validation error"))):Promise.reject(e)}));var E=Object(f.generateAuthActions)(_),D=E.verifyCredentials,I=function(e){return A(A({},e.reduxTokenAuth.currentUser),e.reduxTokenAuth.currentUser.attributes)},M=function(e){return e.reduxTokenAuth.currentUser.isSignedIn},T=function(e){return e.reduxTokenAuth.currentUser.hasVerificationBeenAttempted};function R(e){return function(e){if(Array.isArray(e))return U(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return U(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return U(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function U(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var L=Object(d.b)({name:"chats",initialState:{chats:[]},reducers:{addChat:function(e,t){var n=e.chats.find((function(e){return e.id===t.payload.id}));if(n)n.last_at=t.payload.last_at,n.preview=t.payload.preview;else{if(!t.payload.last_at)return e;e.chats=[].concat(R(e.chats),[t.payload]).sort(B)}},setChats:function(e,t){e.chats=t.payload.sort(B)},removeChat:function(e,t){e.chats=e.chats.filter((function(e){return e.id!==t.payload.id}))},clearChats:function(e,t){e.chats=[]},appendChatMessage:function(e,t){var n=t.payload,r=e.chats.find((function(e){return e.id===n.conversation_id}));r?(r.preview=n.body,r.last_at=n.created_at,r.action="",e.chats.sort(B)):_e.chats.requestChatInfo(n.conversation_id)},setTyping:function(e,t){var n=t.payload,r=e.chats.find((function(e){return e.id===n}));r&&(r.action="Typing",r.actionEnd=Date.now()+5e3,setTimeout((function(){Ye.dispatch(V())}),5e3))},checkTyping:function(e,t){var n=Date.now();e.chats.forEach((function(e){e.actionEnd<n&&(e.action="")}))},updateChatsAvatar:function(e,t){var n=t.payload;e.chats.forEach((function(e){e.sender_id===n.id&&(e.sender=n),e.recipient_id===n.id&&(e.recipient=n)}))}}});function B(e,t){return t.last_at.localeCompare(e.last_at)}var F=L.reducer,q=L.actions,Q=q.addChat,W=(q.removeChat,q.setChats),$=q.clearChats,z=q.appendChatMessage,K=q.setTyping,V=q.checkTyping,Y=q.updateChatsAvatar,Z=function(e){return e.chats.chats},H=Object(d.b)({name:"users",initialState:{all:[]},reducers:{setUsers:function(e,t){e.all=t.payload},clearUsers:function(e,t){e.all=[]}}}),J=H.reducer,X=H.actions,G=X.setUsers,ee=X.clearUsers;function te(e,t,n,r,a,c,o){try{var i=e[c](o),s=i.value}catch(e){return void n(e)}i.done?t(s):Promise.resolve(s).then(r,a)}function ne(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var c=e.apply(t,n);function o(e){te(c,r,a,o,i,"next",e)}function i(e){te(c,r,a,o,i,"throw",e)}o(void 0)}))}}function re(e){navigator.clipboard?navigator.clipboard.writeText(e):function(e){var t=document.createElement("textarea");t.value=e,t.style.top="0",t.style.left="0",t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy")}catch(e){console.error("Failed to copy text to clipboard!",e)}document.body.removeChild(t)}(e)}function ae(e){return ce.apply(this,arguments)}function ce(){return(ce=ne(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.arrayBuffer();case 2:return n=e.sent,r=new Uint8Array(n),e.abrupt("return",Array.from(r));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var oe=n(140);function ie(e){return function(e){if(Array.isArray(e))return ue(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||se(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function se(e,t){if(e){if("string"==typeof e)return ue(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ue(e,t):void 0}}function ue(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function le(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var fe=function(){function e(){var t,n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var r=T(Ye.getState());this.currentAuth=I(Ye.getState()),r&&null!==(t=this.currentAuth)&&void 0!==t&&t.id&&(this._consumer=Object(oe.createConsumer)(this._makeSocketUrl())),this.unsubscribe=Ye.subscribe((function(){var e=n.currentAuth;n.currentAuth=I(Ye.getState()),n.currentAuth&&n.currentAuth.id===e.id||n.reconnect()})),this.connected=!1,this.queue=[]}var t,n,r;return t=e,(n=[{key:"reconnect",value:function(){this._loadAuthData().uid&&(this._consumer?(this._consumer.disconnect(),this._consumer._url=this._makeSocketUrl(),this._consumer.connect()):this._consumer=Object(oe.createConsumer)(this._makeSocketUrl()),this.onReconnect())}},{key:"onReconnect",value:function(){}},{key:"consumer",get:function(){return this._consumer}},{key:"create",value:function(e,t){var n,r,a=this,c=t.connected;t.connected=function(){a.connected=!0,a._onConnect(),null==c||c()};var o=t.disconnected;return t.disconnected=function(){a.connected=!1,a._onDisconnect(),null==o||o()},null===(n=this._consumer)||void 0===n||null===(r=n.subscriptions)||void 0===r?void 0:r.create(e,t)}},{key:"performOrQueue",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];1===n.length&&n.push({}),this.connected&&(e=this.subscription).perform.apply(e,n)||this.queue.push(n)}},{key:"_onConnect",value:function(){clearInterval(this.reconnectInterval);var e,t=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=se(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,o=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){i=!0,c=e},f:function(){try{o||null==n.return||n.return()}finally{if(i)throw c}}}}(this.queue);try{for(t.s();!(e=t.n()).done;){var n,r=e.value;(n=this.subscription).perform.apply(n,ie(r))||console.error("Failed to perform queued operation!")}}catch(e){t.e(e)}finally{t.f()}this.queue=[]}},{key:"_onDisconnect",value:function(){clearInterval(this.reconnectInterval)}},{key:"_loadAuthData",value:function(){return{"access-token":window.localStorage.getItem("access-token")||"",uid:window.localStorage.getItem("uid")||"",client:window.localStorage.getItem("client")||""}}},{key:"_makeSocketUrl",value:function(e){e||(e=this._loadAuthData());var t=e,n=t["access-token"],r=t.uid,a=t.client;return"".concat("wss://rubygramreact.herokuapp.com/cable","?access-token=").concat(n,"&uid=").concat(r,"&client=").concat(a)}},{key:"close",value:function(){this.unsubscribe(),this._consumer.disconnect()}}])&&le(t.prototype,n),r&&le(t,r),e}();function de(e){return(de="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function pe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function be(e,t){return(be=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function he(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ye(e);if(t){var a=ye(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return me(this,n)}}function me(e,t){return!t||"object"!==de(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ye(e){return(ye=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ve=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&be(e,t)}(c,e);var t,n,r,a=he(c);function c(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(e=a.call(this))._initChannel(),e}return t=c,(n=[{key:"onReconnect",value:function(){this.subscription||this._initChannel()}},{key:"_initChannel",value:function(){this.subscription=this.create("ConversationChannel",{connected:function(){return console.log("Connected chat")},disconnected:function(){return console.log("Disconnected chat")},received:function(e){switch(console.log(e),e.type){case"allUsers":Ye.dispatch(G(e.users));break;case"allConversations":Ye.dispatch(W(e.conversations));break;case"getConversation":Ye.dispatch(We(e.conversation)),Ye.dispatch(Q(e.conversation));break;case"getConversationInfo":Ye.dispatch(Q(e.conversation));break;case"typing":Ye.dispatch(K(e.conversation_id));break;case"searchUsers":Ye.dispatch(g(e.users));break;case"updateAvatar":Ye.dispatch(Y(e.user)),Ye.dispatch($e(e.user)),D(Ye)}}})}},{key:"checkConnection",value:function(){this.performOrQueue("checkConnection",{})}},{key:"requestAllUsers",value:function(){this.performOrQueue("allUsers",{})}},{key:"requestAllChats",value:function(){this.performOrQueue("allConversations",{})}},{key:"requestChat",value:function(e){this.performOrQueue("getConversation",{peer_id:e})}},{key:"requestChatInfo",value:function(e){this.performOrQueue("getConversationInfo",{conversation_id:e})}},{key:"sendTyping",value:function(e){this.performOrQueue("sendTyping",{peer_id:e})}},{key:"searchUsers",value:function(e){this.performOrQueue("searchUsers",{query:e})}},{key:"uploadAvatar",value:function(e){var t=this;e.size>5242880||ae(e).then((function(n){t.performOrQueue("uploadAvatar",{bytes:n,content_type:e.type})}))}}])&&pe(t.prototype,n),r&&pe(t,r),c}(fe);function je(e){return(je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ge(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Oe(e,t){return(Oe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function we(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Se(e);if(t){var a=Se(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return xe(this,n)}}function xe(e,t){return!t||"object"!==je(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Se(e){return(Se=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ke=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Oe(e,t)}(c,e);var t,n,r,a=we(c);function c(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(e=a.call(this))._initChannel(),e}return t=c,(n=[{key:"onReconnect",value:function(){this.subscription||this._initChannel()}},{key:"_initChannel",value:function(){this.subscription=this.create("MessageChannel",{connected:function(){return console.log("Connected message")},disconnected:function(){return console.log("Disconnected message")},received:function(e){switch(console.log(e),e.type){case"messages":Ye.dispatch(Be(e.messages));break;case"newMessage":Ye.dispatch(qe(e.message)),Ye.dispatch(z(e.message));break;case"deleteMessage":Ye.dispatch(Fe(e.message_id));break;default:console.log(e)}}})}},{key:"sendMessage",value:function(e,t){this.performOrQueue("sendMessage",{message:{text:t},peer:{id:e}})}},{key:"sendFile",value:function(e,t,n){var r=this;n=n||t.filename,ae(t).then((function(a){r.performOrQueue("sendFile",{file:{bytes:a,content_type:t.type,filename:n},peer:{id:e}})}))}},{key:"requestAllMessages",value:function(e){this.performOrQueue("getMessages",{peer:e})}},{key:"delete",value:function(e){this.performOrQueue("deleteMessage",{id:e})}},{key:"edit",value:function(e,t){this.performOrQueue("editMessage",{id:e,body:t})}}])&&ge(t.prototype,n),r&&ge(t,r),c}(fe);function Ce(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ae,Pe,Ne,_e=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"closeAll",value:function(){this.opened&&(this.chats.close(),this.messages.close(),this.opened=!1)}},{key:"openAll",value:function(){this.opened||(this.chats=new ve,this.messages=new ke,this.opened=!0)}}])&&Ce(t.prototype,n),r&&Ce(t,r),e}()),Ee=(null==Ye||null===(Ae=Ye.getState)||void 0===Ae||null===(Pe=Ae.call(Ye))||void 0===Pe||null===(Ne=Pe.reduxTokenAuth)||void 0===Ne?void 0:Ne.currentUser)||{};function De(){return Ee}function Ie(e){return function(e){if(Array.isArray(e))return Me(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Me(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Me(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Me(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}window.getUser=De;var Te={peer:null,conversationId:-1,messages:[]},Re=Object(d.b)({name:"activeChat",initialState:Te,reducers:{setMessages:function(e,t){var n=t.payload;n.length?n[0].conversation_id===e.conversationId&&(e.messages=n):e.messages=n},clearMessages:function(e,t){e.messages=[]},deleteMessage:function(e,t){e.messages[e.messages.length-1].id===t.payload&&_e.chats.requestChatInfo(e.conversation_id),e.messages=e.messages.filter((function(e){return e.id!==t.payload}))},appendMessages:function(e,t){e.messages=e.messages.concat(t.payload)},appendMessageIfCurrent:function(e,t){e.conversationId===t.payload.conversation_id&&(e.messages=[].concat(Ie(e.messages),[t.payload]))},setPeer:function(e,t){e.peer=t.payload},clearPeer:function(e,t){e.peer=null,e.conversationId=-1},resetActiveChat:function(e){return Te},setConversation:function(e,t){var n=De().id;e.peer=n===t.payload.recipient.id?t.payload.sender:t.payload.recipient,e.messages=t.payload.messages,e.conversationId=t.payload.id},checkAndUpdatePeerAvatar:function(e,t){var n,r=t.payload;(null===(n=e.peer)||void 0===n?void 0:n.id)===r.id&&(e.peer=r)}}}),Ue=Re.reducer,Le=Re.actions,Be=Le.setMessages,Fe=Le.deleteMessage,qe=(Le.clearMessages,Le.appendMessages,Le.appendMessageIfCurrent),Qe=(Le.setPeer,Le.clearPeer,Le.resetActiveChat),We=Le.setConversation,$e=Le.checkAndUpdatePeerAvatar,ze=function(e){return e.activeChat.peer},Ke=function(e){return e.activeChat.messages},Ve=function(e){return e.activeChat.conversationId};var Ye=Object(d.a)({reducer:{chats:F,users:J,activeChat:Ue,interface:m,reduxTokenAuth:f.reduxTokenAuthReducer},devTools:!1,preloadedState:{reduxTokenAuth:{currentUser:{isLoading:!1,isSignedIn:!1,hasVerificationBeenAttempted:!1,attributes:{email:null,name:null,nickname:null,image:null,avatar_url:null}}}}});var Ze=function(e){var t=Object(r.useRef)(!0);t.current&&e(),t.current=!1},He=n(0);function Je(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null==n)return;var r,a,c=[],o=!0,i=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(c.push(r.value),!t||c.length!==t);o=!0);}catch(e){i=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(i)throw a}}return c}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Xe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Xe(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Xe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Ge=[],et=function(e){Ge=e},tt=function(){var e,t,n=Object(o.useSelector)(k),a=n.x,c=n.y,i=Je(Object(r.useState)("left-top"),2),s=i[0],u=i[1],f=Je(Object(r.useState)(!0),2),d=f[0],p=f[1],b=Je(Object(r.useState)(!1),2),h=b[0],m=b[1],y=Je(Object(r.useState)(!0),2),v=y[0],j=y[1],g=Object(o.useDispatch)(),w=function(){j(!0),m(!1)};return e="Escape",t=function(){w()},Object(r.useEffect)((function(){function n(n){n.key===e&&t()}return window.addEventListener("keyup",n),function(){return window.removeEventListener("keyup",n)}}),[]),Object(r.useEffect)((function(){if(Ge.length){var e=64*Ge.length,t=window.innerWidth,n=window.innerHeight,r=document.querySelector("#App").clientWidth,o=document.querySelector("#App").clientHeight,i=a,l=c,f=s;(i-=(t-r)/2)+220>=t&&(i-=220,f="right-top"),(l-=(n-o)/2)+e>=n&&(f="right-top"===s?"right-bottom":"left-bottom",(l-=e)<=0&&(l=0)),u(f),g(O({x:i,y:l})),j(!1),p(!1),m(!0)}else v||j(!0)}),[Ge]),Object(He.jsx)("div",{className:l()({"context-menu-wrapper":!0,unhidden:h,"really-hidden":d,hidden:v}),onClick:w,onContextMenu:w,onAnimationEnd:function(e){"hidden-context"===e.animationName&&(p(!0),et([]))},children:Object(He.jsx)("div",{className:l()("context-menu",s),style:{top:c+"px",left:a+"px"},children:Ge.map((function(e,t){return Object(He.jsxs)("div",{className:l()({element:!0,red:e.red}),onClick:function(t){var n;null===(n=e.onClick)||void 0===n||n.call(e),t.stopPropagation(),w()},children:[e.icon&&Object(He.jsx)("i",{className:"tgico tgico-".concat(e.icon)}),Object(He.jsx)("span",{children:e.title})]},t)}))})})},nt=function(e){return 0===e.length?function(){}:function(t){t.preventDefault(),et(e),Ye.dispatch(O({x:t.clientX,y:t.clientY}))}};n(454);function rt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function at(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null==n)return;var r,a,c=[],o=!0,i=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(c.push(r.value),!t||c.length!==t);o=!0);}catch(e){i=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(i)throw a}}return c}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ct(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ct(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ct(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var ot=function(e,t,n){return console.log("Don't call theme change before init!"),!1},it=Object(r.createContext)({theme:"dark",initiateChange:ot}),st=function(e){var t,n=e.setInitiateChange,a=e.setTheme,c=e.children,o=Object(r.useContext)(it),i=Object(r.useRef)(null),s=at(Object(r.useState)(!1),2),u=s[0],f=s[1];return Object(r.useEffect)((function(){setTimeout((function(){return n((function(){return function(e,t,n){return!u&&(function(e,t,n){f(!0);var r=i.current;if(!r)return!1;var c=r.cloneNode(!0);c.classList.add("dummy"),window.document.body.appendChild(c),a(e);var o=Date.now();(function e(){var r=(Date.now()-o)/800;if(r>1)return c.remove(),void f(!1);var a="radial-gradient(circle farthest-side at ".concat(t,"px ").concat(n,"px, transparent ").concat(150*r,"%, white ").concat(150*r+1,"%)");c.style.webkitMaskImage=a,c.style.maskImage=a,window.requestAnimationFrame(e)})()}(e,t,n),!0)}}))}))}),[u]),Object(He.jsx)("div",{className:l()((t={theme:!0},rt(t,o.theme,!0),rt(t,"animating",u),t)),ref:i,children:c})},ut=function(e){var t=e.children;Ze((function(){!localStorage.getItem("theme")&&localStorage.setItem("theme",window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}));var n=at(Object(r.useState)(localStorage.getItem("theme")),2),a=n[0],c=n[1],o=at(Object(r.useState)((function(){return ot})),2),i=o[0],s=o[1];return Object(r.useEffect)((function(){localStorage.setItem("theme",a)}),[a]),Object(He.jsx)(it.Provider,{value:{theme:a,initiateChange:i},children:Object(He.jsx)(st,{setInitiateChange:s,setTheme:c,children:t})})};n(456);function lt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ft(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?lt(Object(n),!0).forEach((function(t){dt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function dt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function pt(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},c=Object.keys(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var bt=function(e){var t=e.flat,n=void 0!==t&&t,r=e.uppercase,a=void 0===r||r,c=e.className,o=e.children,i=pt(e,["flat","uppercase","className","children"]);return Object(He.jsx)("button",ft(ft({className:l()({VButton:!0,flat:n,uppercase:a},c)},i),{},{children:o}))},ht=(n(458),function(e){var t=e.id,n=e.type,r=void 0===n?"text":n,a=e.width,c=void 0===a?"auto":a,o=e.name,i=void 0===o?null:o,s=e.label,u=void 0===s?"":s,f=e.onChange,d=e.onKeyPress,p=e.onFocus,b=e.pattern,h=e.onBlur,m=e.value,y=void 0===m?"":m,v=e.autoFocus,j=e.error,g=e.success,O=e.filledText,w=e.disabled,x=void 0!==w&&w,S=e.onKeyDown,k=e.maxLength,C=u;return j?(g=!1,C=j):g&&(j=!1,C=g||u),Object(He.jsxs)("div",{className:"VInput","css-width":c,children:[Object(He.jsx)("input",{id:t,disabled:x?"true":void 0,className:l()({invalid:j,success:g}),type:r,placeholder:C,name:i,value:y,onChange:f,onKeyPress:d,onBlur:h,onFocus:p,autoFocus:v,maxLength:k,onKeyDown:S,pattern:b}),Object(He.jsx)("label",{htmlFor:i,children:y&&O?O:C})]})}),mt=function(){return Object(He.jsx)("div",{style:{position:"relative",width:"100%",height:"100%"},className:"loader",children:Object(He.jsx)("img",{src:"./images/loader.gif",alt:"Loading...",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"2em",height:"2em"}})})};function yt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null==n)return;var r,a,c=[],o=!0,i=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(c.push(r.value),!t||c.length!==t);o=!0);}catch(e){i=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(i)throw a}}return c}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return vt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return vt(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function vt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var jt=function(){var e=Object(o.useSelector)(I),t=Object(s.f)(),n=yt(Object(r.useState)(!1),2),a=n[0],c=n[1],i=yt(Object(r.useState)(""),2),u=i[0],l=i[1],f=yt(Object(r.useState)(""),2),d=f[0],p=f[1],b=yt(Object(r.useState)(""),2),h=b[0],m=b[1],y=yt(Object(r.useState)(""),2),v=y[0],j=y[1],g=yt(Object(r.useState)(""),2),O=g[0],x=g[1],S=yt(Object(r.useState)(""),2),k=S[0],C=S[1],A=Object(o.useSelector)(w),P=Object(o.useDispatch)();if(Ze((function(){P(Qe()),P($()),P(ee()),_e.closeAll()})),Object(r.useEffect)((function(){null!=A&&A.full_messages?C(A.full_messages[0]):C(A)}),[A]),Object(r.useEffect)((function(){C("")}),[u,d,h,v,O,a]),Object(r.useEffect)((function(){e.isSignedIn&&!e.isLoading&&t.replace("/")}),[e,t]),e.isLoading||!e.hasVerificationBeenAttempted)return Object(He.jsx)(mt,{});var N,_=function(e){if(!function(e){return/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())}(u))return C("Bad email format!"),!1;if(v.length<6)return C("Password must be 6 symbols or longer"),!1;if(e){if(!d)return C("Name can't be blank!"),!1;if(!h)return C("Nickname can't be blank!"),!1;if(v!==O)return C("Passwords don't match!"),!1}return!0};return N=a?Object(He.jsxs)("div",{className:"panel sign-up",children:[Object(He.jsx)("img",{src:"./images/rubygram.png",alt:"Rubygram",className:"logo"}),Object(He.jsx)("div",{className:"panel-title",children:"Sign up"}),Object(He.jsx)(ht,{type:"text",label:"E-mail",onChange:function(e){return l(e.currentTarget.value)},value:u}),Object(He.jsx)(ht,{type:"text",label:"Name",onChange:function(e){return p(e.currentTarget.value)},value:d}),Object(He.jsx)(ht,{type:"text",label:"Nickname",onChange:function(e){return m(e.currentTarget.value)},value:h}),Object(He.jsx)(ht,{type:"password",label:"Password",onChange:function(e){return j(e.currentTarget.value)},value:v}),Object(He.jsx)(ht,{type:"password",label:"Confirm Password",onChange:function(e){return x(e.currentTarget.value)},value:O}),k&&Object(He.jsx)("div",{className:"error",children:k}),Object(He.jsx)(bt,{onClick:function(){return _(!0)&&function(){return E.registerUser.apply(E,arguments)(Ye.dispatch)}({email:u,name:d,password:v,passwordConfirmation:O,nickname:h}).then((function(){return console.log("Signed up")}))},children:"Sign up"}),Object(He.jsx)(bt,{flat:!0,onClick:function(){return c(!1)},children:"Already registered?"})]}):Object(He.jsxs)("div",{className:"panel sign-in",children:[Object(He.jsx)("img",{src:"./images/rubygram.png",alt:"Rubygram",className:"logo"}),Object(He.jsx)("div",{className:"panel-title",children:"Sign in"}),Object(He.jsx)(ht,{type:"email",label:"E-mail",onChange:function(e){return l(e.currentTarget.value)},value:u}),Object(He.jsx)(ht,{type:"password",label:"Password",onChange:function(e){return j(e.currentTarget.value)},value:v}),k&&Object(He.jsx)("div",{className:"error",children:k}),Object(He.jsx)(bt,{onClick:function(){return _()&&function(){return E.signInUser.apply(E,arguments)(Ye.dispatch)}({email:u,password:v}).then((function(){return console.log("Logged in")}))},children:"Sign in"}),Object(He.jsx)(bt,{flat:!0,className:"sign-up",onClick:function(){return c(!0)},children:"Sign up"})]}),Object(He.jsx)("div",{className:"login",children:N})};n(460);function gt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ot(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?gt(Object(n),!0).forEach((function(t){wt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function wt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function xt(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},c=Object.keys(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var St=function(e){var t=e.icon,n=e.className,r=xt(e,["icon","className"]);return Object(He.jsx)("button",Ot(Ot({className:"icon-button ".concat(n)},r),{},{children:Object(He.jsx)("i",{className:"tgico tgico-".concat(t)})}))};n(462);function kt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ct(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?kt(Object(n),!0).forEach((function(t){At(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function At(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Pt(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},c=Object.keys(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var Nt=["#cc90e2","#80d066","#ecd074","#6fb1e4","#e57979","#f98bae","#73cdd0","#fba76f"],_t=function(e){var t=e.user,n=Pt(e,["user"]),r=t.avatar_url;return Object(He.jsxs)("div",Ct(Ct({className:"user-avatar",style:{backgroundColor:r?"black":Nt[t.id%Nt.length]}},n),{},{children:[Object(He.jsx)("div",{className:"avatar-text",children:(t.name||"???").slice(0,2)}),r&&Object(He.jsx)("img",{src:r,alt:"".concat(t.name," avatar"),className:"avatar-image"})]}))},Et=(n(464),function(e){var t=e.peer,n=e.action,r=Object(s.f)();return Object(He.jsxs)("div",{className:"chat-header",children:[Object(He.jsx)(St,{icon:"back",className:"back desktop-hidden",onClick:function(){r.replace("?")}}),Object(He.jsx)(_t,{user:t}),Object(He.jsxs)("div",{className:"info",children:[Object(He.jsx)("div",{className:"name",children:(null==t?void 0:t.name)||"???"}),!n&&(null==t?void 0:t.nickname)&&Object(He.jsx)("div",{className:"nickname",children:"@".concat(t.nickname)}),n&&Object(He.jsx)("div",{className:"action loading-text",children:n})]})]})}),Dt=n(230);(function(){if(!!window.opr&&!!window.opr.addons||!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0)return"Opera";if("undefined"!=typeof InstallTrigger)return"Firefox";if(Rt)return"Safari";var e=!!document.documentMode;if(e)return"Internet Explorer (pls, update)";if(!e&&!!window.StyleMedia)return"Microsoft Edge";var t=!(!window.chrome||!window.chrome.webstore&&!window.chrome.runtime);t||t&&navigator.userAgent.indexOf("Edg")})(),It=window.navigator.userAgent,Mt=window.navigator.platform,Tt=null,-1!==["Macintosh","MacIntel","MacPPC","Mac68K"].indexOf(Mt)?Tt="mac":-1!==["iPhone","iPad","iPod"].indexOf(Mt)?Tt="ios":-1!==["Win32","Win64","Windows","WinCE"].indexOf(Mt)?Tt="windows":/Android/.test(It)?Tt="android":!Tt&&/Linux/.test(Mt)&&(Tt="linux");var It,Mt,Tt,Rt=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),Ut=!(window.innerWidth<991.98);function Lt(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=document.createElement("input");a.type="file",a.accept=e,a.multiple=r,a.style.visibility="hidden",document.body.append(a),a.addEventListener("change",(function(e){Array.from(e.target.files).forEach((function(e){var r=new FileReader;n?r.readAsArrayBuffer(e):r.readAsDataURL(e),r.onload=function(n){a.remove(),t(r.result,e)}}))})),a.click()}n(466);function Bt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null==n)return;var r,a,c=[],o=!0,i=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(c.push(r.value),!t||c.length!==t);o=!0);}catch(e){i=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(i)throw a}}return c}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ft(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ft(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ft(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function qt(e,t,n){t&&(_e.messages.sendMessage(e.id,t),n(""))}var Qt=function(){var e=Object(o.useSelector)(ze),t=Bt(Object(r.useState)(""),2),n=t[0],a=t[1],c=Object(r.useRef)();Object(r.useEffect)((function(){a("")}),[e.id]);return Object(He.jsxs)("div",{className:"chat-input-wrapper",children:[Object(He.jsx)(St,{className:"chat-input-button attach",icon:"attach",onClick:function(){Lt("*",(function(t,n){_e.messages.sendFile(e.id,n,n.name)}))}}),Object(He.jsx)("div",{className:"chat-input",children:Object(He.jsx)("div",{className:"chat-input-scroll-wrapper",children:Object(He.jsx)(Dt.a,{autoFocus:!0,minRows:3,className:"text-area",placeholder:"Enter message...",onChange:function(t){a(t.currentTarget.value),(!c.current||c.current+3e3<Date.now())&&(_e.chats.sendTyping(e.id),c.current=Date.now())},value:n,onPaste:function(t){return function(t){var n=Array.from(t.clipboardData.items).find((function(e){return e.type.includes("image")}));if(n){t.preventDefault();var r=n.getAsFile();_e.messages.sendFile(e.id,r,r.name)}}(t)},onKeyPress:function(t){"Enter"===t.key&&(!Ut||t.ctrlKey||t.shiftKey||(qt(e,n,a),t.preventDefault()))}})})}),Object(He.jsx)("button",{className:"chat-input-button send",onClick:function(){return qt(e,n,a)},children:"Send"})]})},Wt=n(223),$t=n.n(Wt),zt=n(224),Kt=n.n(zt),Vt={hour:"2-digit",minute:"2-digit"},Yt={year:"2-digit",month:"2-digit",day:"2-digit"};function Zt(e){var t=Date.now()/1e3,n=e.getTime()/1e3,r=Vt;return Math.abs(t-n)>86400&&(r=Yt),new Date(1e3*n).toLocaleString(window.navigator.language,r)}var Ht=["#E93A3A","#4FAE4E","#4BA8FD","#F58505"];function Jt(e){return function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Xt(e,-40);return t?Object(He.jsx)("svg",{width:"54px",height:"54px",viewBox:"0 0 54 54",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:Object(He.jsx)("rect",{rx:"6",ry:"6",fill:e,width:"54",height:"54"})}):Object(He.jsx)("svg",{width:"54px",height:"54px",viewBox:"0 0 54 54",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:Object(He.jsxs)("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd",children:[Object(He.jsx)("path",{d:"M54,22 C54,19.790861 52.209139,18 50,18 L40,18 C37.790861,18 36,16.209139 36,14 L36,4 C36,1.790861 34.209139,-4.05812251e-16 32,0 L33.8020203,8.8817842e-15 C35.3933192,1.00028247e-14 36.9194427,0.632141042 38.0446609,1.75735931 L52.2426407,15.9553391 C53.367859,17.0805573 54,18.6066808 54,20.1979797 L54,22 Z",id:"Corner",fill:n}),Object(He.jsx)("path",{d:"M36,4 L36,14 C36,16.209139 37.790861,18 40,18 L50,18 C52.209139,18 54,19.790861 54,22 L54,48 C54,51.3137085 51.3137085,54 48,54 L6,54 C2.6862915,54 0,51.3137085 0,48 L0,6 C0,2.6862915 2.6862915,0 6,0 L32,0 C34.209139,-4.05812251e-16 36,1.790861 36,4 Z",id:"Base",fill:e})]})})}(function(e){switch(e=e.toLowerCase()){case"pdf":case"ppt":case"pptx":case"key":return Ht[0];case"xls":case"xlsx":case"csv":return Ht[1];case"doc":case"docx":case"rtf":case"txt":case"psd":return Ht[2];case"zip":case"7z":case"rar":case"tar":case"ai":case"mp3":case"mov":case"avi":return Ht[3];default:return Ht[e.charCodeAt(0)%4]}}(e.split(".")[e.split(".").length-1]))}function Xt(e,t){return"#"+e.replace(/^#/,"").replace(/../g,(function(e){return("0"+Math.min(255,Math.max(0,parseInt(e,16)+t)).toString(16)).substr(-2)}))}function Gt(e){if(!e)return"0B";var t=Math.floor(Math.log(e)/Math.log(1024));return 1*(e/Math.pow(1024,t)).toFixed(2)+" "+["B","kB","MB","GB","TB"][t]}function en(e,t){var n=document.createElement("a");document.body.appendChild(n),n.style="display: none",n.href=e,n.download=t,n.click(),n.remove()}var tn=n(815),nn=n(814);function rn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function an(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?rn(Object(n),!0).forEach((function(t){cn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function cn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function on(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},c=Object.keys(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var sn=function(e){e.node;var t=e.inline,n=e.className,r=e.children,a=on(e,["node","inline","className","children"]),c=/language-(\w+)/.exec(n||"");return!t&&c?Object(He.jsx)(tn.a,an({style:nn.a,language:c[1],wrapLongLines:!0,PreTag:"div",children:String(r).replace(/\n$/,"")},a)):Object(He.jsx)("code",an(an({className:n},a),{},{children:r}))};n(794);function un(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ln(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?un(Object(n),!0).forEach((function(t){fn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):un(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function fn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var dn=["p","span","b","strong","i","em","a","del","s","pre","code","text"],pn=function(e){var t,n,r=e.message,a=Object(o.useSelector)(I),c=r.user.id===a.id,i=l()({"message-wrapper":!0,out:c,in:!c}),s=[{icon:"copy",title:"Copy",onClick:function(){return re(r.body)}}];c&&s.push({icon:"delete",red:!0,title:"Delete",onClick:function(){return _e.messages.delete(r.id)}});var u=null===(t=r.file)||void 0===t||null===(n=t.content_type)||void 0===n?void 0:n.startsWith("image");return Object(He.jsxs)("div",{className:i,onContextMenu:nt(s),children:[!c&&Object(He.jsx)(_t,{user:r.user}),Object(He.jsxs)("div",{className:"message",children:[!c&&Object(He.jsx)("div",{className:"name",children:r.user.name}),Object(He.jsxs)("div",{className:"content-wrapper",children:[r.file_url&&Object(He.jsx)("div",{className:"attachment ".concat(u?"no-pad":""),children:u?Object(He.jsx)("img",{src:r.file_url,className:"attachment-image",alt:"Attachment"}):Object(He.jsxs)("div",{className:"attachment-file",onClick:function(){return en(r.file_url)},children:[Object(He.jsx)("div",{className:"icon",children:Jt(r.file.filename)}),Object(He.jsxs)("div",{className:"file-info",children:[Object(He.jsx)("div",{className:"filename",children:r.file.filename}),Object(He.jsx)("div",{className:"filesize",children:Gt(r.file.byte_size)})]})]})}),r.body&&Object(He.jsx)("span",{className:"text",children:Object(He.jsx)($t.a,{skipHtml:!0,remarkPlugins:[Kt.a],linkTarget:"_blank",components:{code:sn},allowedElemensts:dn,children:r.body})}),Object(He.jsx)("div",{className:"time",title:new Date(r.updated_at).toLocaleString(window.navigator.language,ln(ln({},Vt),Yt)),children:new Date(r.updated_at).toLocaleString(window.navigator.language,Vt)})]})]})]})},bn=(n(796),function(e){var t=e.date;return Object(He.jsx)("div",{className:"service-message",children:t.toLocaleDateString(window.navigator.language,{day:"numeric",month:"long",year:"numeric"})})});function hn(e){return e.map((function(e,t,n){if(t===n.length-1)return e;if(0===t)return[{separator:!0,date:new Date(e.created_at),id:"start-date-separator"},e];var r=new Date(e.created_at),a=new Date(n[t+1].created_at);return r.getDate()===a.getDate()&&r.getMonth()===a.getMonth()&&r.getFullYear()===a.getFullYear()?e:[e,{separator:!0,date:a,id:"".concat(e.id,"-date-separator")}]})).flat(1)}var mn=function(){var e=Object(o.useSelector)(Ke),t=Object(r.useRef)();return Object(r.useEffect)((function(){t.current.scrollIntoView({behavior:"smooth"})}),[e]),Object(He.jsxs)("div",{className:"message-container",children:[Object(He.jsx)("div",{className:"messages-end",ref:t}),hn(e).map((function(e){return e.separator?Object(He.jsx)(bn,{date:e.date},e.id):Object(He.jsx)(pn,{message:e},e.id)})).reverse()]})};n(798);function yn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null==n)return;var r,a,c=[],o=!0,i=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(c.push(r.value),!t||c.length!==t);o=!0);}catch(e){i=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(i)throw a}}return c}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return vn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return vn(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function vn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var jn=function(e){var t=e.chat,n=e.user,r=e.selected,a=Object(s.f)(),c=t.recipient_id===n.id?t.sender:t.recipient,o=new Date(t.last_at),i=t.action||t.preview;return Object(He.jsxs)("div",{className:"chat-list-item ".concat(r?"selected":""),onClick:function(){a.replace("?peer=".concat(c.id))},children:[Object(He.jsx)(_t,{user:c}),Object(He.jsxs)("div",{className:"info",children:[Object(He.jsxs)("div",{className:"top-line",children:[Object(He.jsx)("div",{className:"name",children:c.name||"???"}),Object(He.jsx)("div",{className:"time",children:Zt(o)})]}),Object(He.jsx)("div",{className:l()({"chat-preview":!0,"loading-text":t.action}),children:i})]})]})},gn=function(){var e=Object(o.useSelector)(Z),t=Object(o.useSelector)(I),n=Object(o.useSelector)(ze),a=yn(Object(r.useState)(!1),2),c=a[0],i=a[1];Object(r.useEffect)((function(){e&&e.length||_e.chats.requestAllChats(),setTimeout((function(){return i(!0)}),2500)}),[]);var s=Object(He.jsx)(mt,{});return e.length?s=e.map((function(e){return Object(He.jsx)(jn,{chat:e,user:t,selected:n&&n.id===(t.id===e.recipient_id?e.sender_id:e.recipient_id)},e.id)})):c&&(s="No chats!"),Object(He.jsx)("div",{className:"chat-list",children:s})};n(800);function On(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null==n)return;var r,a,c=[],o=!0,i=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(c.push(r.value),!t||c.length!==t);o=!0);}catch(e){i=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(i)throw a}}return c}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return wn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return wn(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function wn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var xn=function(e){var t=e.user,n=Object(s.f)(),r=Object(o.useDispatch)();return Object(He.jsxs)("div",{className:"user",onClick:function(){n.replace("?peer="+t.id),r(j(!1))},children:[Object(He.jsx)(_t,{user:t}),Object(He.jsxs)("div",{className:"info",children:[Object(He.jsx)("div",{className:"user-name",children:t.name}),t.nickname&&Object(He.jsxs)("div",{className:"user-nickname",children:["@",t.nickname]})]})]})},Sn=function(){var e=On(Object(r.useState)(""),2),t=e[0],n=e[1],a=Object(o.useSelector)(S),c=Object(o.useDispatch)(),i=Object(r.useRef)(function(e,t){var n,r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return function(){var c=arguments;a||(a=this),r?(clearTimeout(n),n=setTimeout((function(){Date.now()-r>=t&&(e.apply(a,c),r=Date.now())}),t-(Date.now()-r))):(e.apply(a,arguments),r=Date.now())}}((function(e){return _e.chats.searchUsers(e)}),500));return Object(r.useEffect)((function(){i.current(t)}),[t]),Object(He.jsxs)("div",{className:"search-panel",children:[Object(He.jsxs)("div",{className:"search-panel-header",children:[Object(He.jsx)(St,{className:"back",icon:"back",onClick:function(){return c(j(!1))}}),Object(He.jsx)(ht,{label:"Search",value:t,onChange:function(e){return n(e.currentTarget.value)}})]}),Object(He.jsx)("div",{className:"search-results",children:a.map((function(e){return Object(He.jsx)(xn,{user:e},e.id)}))})]})},kn=(n(802),function(e){var t=e.user,n=Object(o.useDispatch)(),a=Object(r.useContext)(it);return Object(He.jsx)("div",{className:"user-panel",children:Object(He.jsxs)("div",{className:"current-user",children:[Object(He.jsx)(_t,{user:t,onClick:function(){Lt("image/jpeg, image/png",(function(e,t){t.size<5242880?_e.chats.uploadAvatar(t):alert("Too big!")}))}}),Object(He.jsxs)("div",{className:"info",children:[Object(He.jsx)("div",{className:"name",children:t.name||"???"}),t.nickname&&Object(He.jsx)("div",{className:"nickname",children:"@".concat(t.nickname)})]}),Object(He.jsx)(St,{icon:"search",className:"action",onClick:function(){n(j(!0))}}),Object(He.jsx)(St,{icon:"photo",className:"action",onClick:function(e){a.initiateChange("dark"===a.theme?"light":"dark",e.clientX,e.clientY)}}),Object(He.jsx)(St,{icon:"logout",className:"action",onClick:function(){(function(){return E.signOutUser.apply(E,arguments)(Ye.dispatch)})().catch((function(e){return console.log(e)}))}})]})})}),Cn=function(){var e=Object(o.useSelector)(I),t=Object(o.useSelector)(ze),n=Object(o.useSelector)(Ve),a=Object(o.useSelector)(Z),c=Object(o.useSelector)(x),i=Object(s.f)(),u=Object(o.useDispatch)(),f=a.find((function(e){return e.id===n}));Ze((function(){_e.openAll()}));var d=Object.fromEntries(new URLSearchParams(Object(s.g)().search)).peer;return Object(r.useEffect)((function(){Number.parseInt(d)&&(null==t?void 0:t.id)!==+d?_e.chats.requestChat(+d):(i.replace("?"),u(Qe()))}),[d]),Object(He.jsxs)("div",{className:"messenger",children:[c?Object(He.jsx)("div",{className:"left-bar",children:Object(He.jsx)(Sn,{})}):Object(He.jsxs)("div",{className:l()({"left-bar":!0,"mobile-hidden":!!t}),children:[Object(He.jsx)(kn,{user:e}),Object(He.jsx)(gn,{})]}),Object(He.jsx)("div",{className:l()({main:!0,"mobile-hidden":!t}),children:t?Object(He.jsxs)("div",{className:"chat",style:{},children:[Object(He.jsx)(Et,{peer:t,action:null==f?void 0:f.action}),Object(He.jsx)(mn,{}),Object(He.jsx)(Qt,{})]}):Object(He.jsx)("div",{className:"select-chat mobile-hidden",children:Object(He.jsx)("div",{className:"select-chat-message",children:"Select chat"})})})]})};function An(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Pn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?An(Object(n),!0).forEach((function(t){Nn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):An(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Nn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var _n="/login";function En(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];return function(){var t=Object(o.useSelector)(M),a=Object(o.useSelector)(T),c=Object(s.f)();return Object(r.useEffect)((function(){a&&!t&&c.replace(_n)}),[t,a,c]),a&&t?Object(He.jsx)(e,Pn({},n)):Object(He.jsx)(mt,{})}}console.log("Running in ".concat("production"," mode"));var Dn=function(){return Object(r.useEffect)((function(){D(Ye),Ye.subscribe((function(){Ee=I(Ye.getState())}))}),[]),Object(He.jsxs)(ut,{children:[Object(He.jsx)(tt,{}),Object(He.jsx)(i.a,{children:Object(He.jsxs)(s.c,{children:[Object(He.jsx)(s.a,{exact:!0,path:"/",component:En(Cn)}),Object(He.jsx)(s.a,{path:"/login",component:jt})]})})]})};n(804);c.a.render(Object(He.jsx)(o.Provider,{store:Ye,children:Object(He.jsx)(Dn,{})}),document.getElementById("App")),"serviceWorker"in navigator&&window.addEventListener("load",(function(){navigator.serviceWorker.register("./service-worker.js").then((function(e){})).catch((function(e){console.log("SW registration failed: ",e)}))}))}});