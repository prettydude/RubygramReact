!function(e){function t(t){for(var r,a,i=t[0],s=t[1],u=t[2],f=0,d=[];f<i.length;f++)a=i[f],Object.prototype.hasOwnProperty.call(c,a)&&c[a]&&d.push(c[a][0]),c[a]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r]);for(l&&l(t);d.length;)d.shift()();return o.push.apply(o,u||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],r=!0,i=1;i<n.length;i++){var s=n[i];0!==c[s]&&(r=!1)}r&&(o.splice(t--,1),e=a(a.s=n[0]))}return e}var r={},c={0:0},o=[];function a(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=r,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="";var i=window.webpackJsonp=window.webpackJsonp||[],s=i.push.bind(i);i.push=t,i=i.slice();for(var u=0;u<i.length;u++)t(i[u]);var l=s;o.push([158,1,2]),n()}({158:function(e,t,n){e.exports=n(399)},399:function(e,t,n){"use strict";n.r(t);n(159);var r=n(0),c=n(77),o=n.n(c),a=n(9),i=n(156),s=n(3),u=n(80),l=n(33),f=n(79),d=n.n(f),p=Object(l.b)({name:"interface",initialState:{darkMode:!1,deviseErrors:null},reducers:{setDarkMode:function(e,t){e.darkMode=t.payload},setDeviseErrors:function(e,t){e.deviseErrors=t.payload},clearDeviseErrors:function(e,t){e.deviseErrors=[]}}}),b=p.reducer,h=p.actions,m=(h.setDarkMode,h.setDeviseErrors),v=(h.clearDeviseErrors,function(e){return e.interface.deviseErrors});function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach((function(t){g(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var O="https://rubygramreact.herokuapp.com/auth",w={authUrl:O,storage:window.localStorage,userAttributes:{email:"email",nickname:"nickname",name:"name",id:"id",provider:"provider",image:"image"},userRegistrationAttributes:{nickname:"nickname",name:"name",image:"image"}};d.a.interceptors.response.use(null,(function(e){var t=e.response;return t.config.url.includes(O)&&t.data.errors?(fe.dispatch(m(t.data.errors)),Promise.reject(new Error("Validation error"))):Promise.reject(e)}));var x,S,k,C=Object(u.generateAuthActions)(w),A=C.verifyCredentials,_=function(e){return j(j({},e.reduxTokenAuth.currentUser),e.reduxTokenAuth.currentUser.attributes)},P=function(e){return e.reduxTokenAuth.currentUser.isSignedIn},N=function(e){return e.reduxTokenAuth.currentUser.hasVerificationBeenAttempted},E=(null==fe||null===(x=fe.getState)||void 0===x||null===(S=x.call(fe))||void 0===S||null===(k=S.reduxTokenAuth)||void 0===k?void 0:k.currentUser)||{};function I(){return E}function T(e){return function(e){if(Array.isArray(e))return D(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return D(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return D(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}window.getUser=I;var M={peer:null,conversationId:-1,messages:[]},U=Object(l.b)({name:"activeChat",initialState:M,reducers:{setMessages:function(e,t){var n=t.payload;n.length?n[0].conversation_id===e.conversationId&&(e.messages=n):e.messages=n},clearMessages:function(e,t){e.messages=[]},appendMessages:function(e,t){e.messages=e.messages.concat(t.payload)},appendMessageIfCurrent:function(e,t){e.conversationId===t.payload.conversation_id&&(e.messages=[].concat(T(e.messages),[t.payload]))},setPeer:function(e,t){e.peer=t.payload},clearPeer:function(e,t){e.peer=null},resetActiveChat:function(e){return M},setConversation:function(e,t){var n=I().id;e.peer=n===t.payload.recipient.id?t.payload.sender:t.payload.recipient,e.messages=t.payload.messages,e.conversationId=t.payload.id}}}),R=U.reducer,q=U.actions,L=q.setMessages,B=(q.clearMessages,q.appendMessages,q.appendMessageIfCurrent),Q=(q.setPeer,q.clearPeer,q.resetActiveChat),F=q.setConversation,K=function(e){return e.activeChat.peer},V=function(e){return e.activeChat.messages},$=function(e){return e.activeChat.conversationId};function W(e){return function(e){if(Array.isArray(e))return z(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return z(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return z(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function z(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var J=Object(l.b)({name:"chats",initialState:{chats:[]},reducers:{addChat:function(e,t){e.chats.find((function(e){var n;return e.id===(null===(n=t.payload)||void 0===n?void 0:n.id)}))||(e.chats=[].concat(W(e.chats),[t.payload]).sort(Z))},setChats:function(e,t){e.chats=t.payload.sort(Z)},removeChat:function(e,t){e.chats=e.chats.filter((function(e){var n;return e.id!==(null===(n=t.payload)||void 0===n?void 0:n.id)}))},clearChats:function(e,t){e.chats=[]},appendChatMessage:function(e,t){var n=t.payload,r=e.chats.find((function(e){return e.id===n.conversation_id}));r?(r.preview=n.body,r.last_at=n.created_at,e.chats.sort(Z)):Te.chats.requestChatInfo(n.user_id)},setTyping:function(e,t){var n=t.payload,r=e.chats.find((function(e){return e.id===n}));r&&(r.action="Typing",r.actionEnd=Date.now()+5e3,setTimeout((function(){fe.dispatch(re())}),5e3))},checkTyping:function(e,t){var n=Date.now();e.chats.forEach((function(e){e.actionEnd<n&&(e.action="")}))}}});function Z(e,t){return t.last_at.localeCompare(e.last_at)}var G=J.reducer,H=J.actions,X=H.addChat,Y=(H.removeChat,H.setChats),ee=H.clearChats,te=H.appendChatMessage,ne=H.setTyping,re=H.checkTyping,ce=function(e){return e.chats.chats},oe=Object(l.b)({name:"users",initialState:{all:[]},reducers:{setUsers:function(e,t){e.all=t.payload},clearUsers:function(e,t){e.all=[]}}}),ae=oe.reducer,ie=oe.actions,se=ie.setUsers,ue=ie.clearUsers,le=function(e){return e.users.all};var fe=Object(l.a)({reducer:{chats:G,users:ae,activeChat:R,interface:b,reduxTokenAuth:u.reduxTokenAuthReducer},devTools:!1,preloadedState:{reduxTokenAuth:{currentUser:{isLoading:!1,isSignedIn:!1,hasVerificationBeenAttempted:!1,attributes:{email:null,name:null,nickname:null,image:null}}}}}),de=n(110);function pe(e){return function(e){if(Array.isArray(e))return he(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||be(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function be(e,t){if(e){if("string"==typeof e)return he(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?he(e,t):void 0}}function he(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function me(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ve=function(){function e(){var t,n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var r=N(fe.getState());this.currentAuth=_(fe.getState()),r&&null!==(t=this.currentAuth)&&void 0!==t&&t.id&&(this._consumer=Object(de.createConsumer)(this._makeSocketUrl())),this.unsubscribe=fe.subscribe((function(){var e=n.currentAuth;n.currentAuth=_(fe.getState()),n.currentAuth&&n.currentAuth.id===e.id||n.reconnect()})),this.connected=!1,this.queue=[]}var t,n,r;return t=e,(n=[{key:"reconnect",value:function(){this._loadAuthData().uid&&(this._consumer?(this._consumer.disconnect(),this._consumer._url=this._makeSocketUrl(),this._consumer.connect()):this._consumer=Object(de.createConsumer)(this._makeSocketUrl()),this.onReconnect())}},{key:"onReconnect",value:function(){}},{key:"consumer",get:function(){return this._consumer}},{key:"create",value:function(e,t){var n,r,c=this,o=t.connected;t.connected=function(){c.connected=!0,c._onConnect(),null==o||o()};var a=t.disconnected;return t.disconnected=function(){c.connected=!1,c._onDisconnect(),null==a||a()},null===(n=this._consumer)||void 0===n||null===(r=n.subscriptions)||void 0===r?void 0:r.create(e,t)}},{key:"performOrQueue",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];1===n.length&&n.push({}),this.connected&&(e=this.subscription).perform.apply(e,n)||this.queue.push(n)}},{key:"_onConnect",value:function(){clearInterval(this.reconnectInterval);var e,t=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=be(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,c=function(){};return{s:c,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:c}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){i=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw o}}}}(this.queue);try{for(t.s();!(e=t.n()).done;){var n,r=e.value;(n=this.subscription).perform.apply(n,pe(r))||console.error("Failed to perform queued operation!")}}catch(e){t.e(e)}finally{t.f()}this.queue=[]}},{key:"_onDisconnect",value:function(){var e=this;clearInterval(this.reconnectInterval),this.reconnectInterval=setInterval((function(){console.log("Trying to reconnect..."),e.reconnect()}),1e4)}},{key:"_loadAuthData",value:function(){return{"access-token":window.localStorage.getItem("access-token")||"",uid:window.localStorage.getItem("uid")||"",client:window.localStorage.getItem("client")||""}}},{key:"_makeSocketUrl",value:function(e){e||(e=this._loadAuthData());var t=e,n=t["access-token"],r=t.uid,c=t.client;return"".concat("wss://rubygramreact.herokuapp.com/cable","?access-token=").concat(n,"&uid=").concat(r,"&client=").concat(c)}},{key:"close",value:function(){this.unsubscribe(),this._consumer.disconnect()}}])&&me(t.prototype,n),r&&me(t,r),e}();function ye(e){return(ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function je(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ge(e,t){return(ge=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Oe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=xe(e);if(t){var c=xe(this).constructor;n=Reflect.construct(r,arguments,c)}else n=r.apply(this,arguments);return we(this,n)}}function we(e,t){return!t||"object"!==ye(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function xe(e){return(xe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Se=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ge(e,t)}(o,e);var t,n,r,c=Oe(o);function o(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(e=c.call(this))._initChannel(),e}return t=o,(n=[{key:"onReconnect",value:function(){this.subscription||this._initChannel()}},{key:"_initChannel",value:function(){this.subscription=this.create("ConversationChannel",{connected:function(){return console.log("Connected chat")},disconnected:function(){return console.log("Disconnected chat")},received:function(e){switch(console.log(e),e.type){case"allUsers":fe.dispatch(se(e.users));break;case"allConversations":fe.dispatch(Y(e.conversations));break;case"getConversation":fe.dispatch(F(e.conversation)),fe.dispatch(X(e.conversation));break;case"getConversationInfo":fe.dispatch(X(e.conversation));break;case"typing":fe.dispatch(ne(e.conversation_id))}}})}},{key:"checkConnection",value:function(){this.performOrQueue("checkConnection",{})}},{key:"requestAllUsers",value:function(){this.performOrQueue("allUsers",{})}},{key:"requestAllChats",value:function(){this.performOrQueue("allConversations",{})}},{key:"requestChat",value:function(e){this.performOrQueue("getConversation",{peer_id:e})}},{key:"requestChatInfo",value:function(e){this.performOrQueue("getConversationInfo",{peer_id:e})}},{key:"sendTyping",value:function(e){this.performOrQueue("sendTyping",{peer_id:e})}}])&&je(t.prototype,n),r&&je(t,r),o}(ve);function ke(e){return(ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ce(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ae(e,t){return(Ae=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _e(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Ne(e);if(t){var c=Ne(this).constructor;n=Reflect.construct(r,arguments,c)}else n=r.apply(this,arguments);return Pe(this,n)}}function Pe(e,t){return!t||"object"!==ke(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ne(e){return(Ne=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ee=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ae(e,t)}(o,e);var t,n,r,c=_e(o);function o(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(e=c.call(this))._initChannel(),e}return t=o,(n=[{key:"onReconnect",value:function(){this.subscription||this._initChannel()}},{key:"_initChannel",value:function(){this.subscription=this.create("MessageChannel",{connected:function(){return console.log("Connected message")},disconnected:function(){return console.log("Disconnected message")},received:function(e){switch(console.log(e),e.type){case"messages":fe.dispatch(L(e.messages));break;case"newMessage":fe.dispatch(B(e.message)),fe.dispatch(te(e.message));break;default:console.log(e)}}})}},{key:"sendMessage",value:function(e,t){this.performOrQueue("sendMessage",{message:{text:t},peer:{id:e}})}},{key:"requestAllMessages",value:function(e){this.performOrQueue("getMessages",{peer:e})}}])&&Ce(t.prototype,n),r&&Ce(t,r),o}(ve);function Ie(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Te=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"init",value:function(){this.openAll()}},{key:"closeAll",value:function(){this.chats.close(),this.messages.close(),this.opened=!1}},{key:"openAll",value:function(){this.opened||(this.chats=new Se,this.messages=new Ee,this.opened=!0)}}])&&Ie(t.prototype,n),r&&Ie(t,r),e}()),De=n(42),Me=n.n(De),Ue=(n(378),n(1));function Re(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function qe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Re(Object(n),!0).forEach((function(t){Le(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Re(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Le(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Be(e,t){if(null==e)return{};var n,r,c=function(e,t){if(null==e)return{};var n,r,c={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(c[n]=e[n]);return c}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(c[n]=e[n])}return c}var Qe=function(e){var t=e.flat,n=void 0!==t&&t,r=e.uppercase,c=void 0===r||r,o=e.className,a=e.children,i=Be(e,["flat","uppercase","className","children"]);return Object(Ue.jsx)("button",qe(qe({className:Me()({VButton:!0,flat:n,uppercase:c},o)},i),{},{children:a}))},Fe=(n(381),function(e){var t=e.id,n=e.type,r=void 0===n?"text":n,c=e.width,o=void 0===c?"auto":c,a=e.name,i=void 0===a?null:a,s=e.label,u=void 0===s?"":s,l=e.onChange,f=e.onKeyPress,d=e.onFocus,p=e.pattern,b=e.onBlur,h=e.value,m=void 0===h?"":h,v=e.autoFocus,y=e.error,j=e.success,g=e.filledText,O=e.disabled,w=void 0!==O&&O,x=e.onKeyDown,S=e.maxLength,k=u;return y?(j=!1,k=y):j&&(y=!1,k=j||u),Object(Ue.jsxs)("div",{className:"VInput","css-width":o,children:[Object(Ue.jsx)("input",{id:t,disabled:w?"true":void 0,className:Me()({invalid:y,success:j}),type:r,placeholder:k,name:i,value:m,onChange:l,onKeyPress:f,onBlur:b,onFocus:d,autoFocus:v,maxLength:S,onKeyDown:x,pattern:p}),Object(Ue.jsx)("label",{htmlFor:i,children:m&&g?g:k})]})});function Ke(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null==n)return;var r,c,o=[],a=!0,i=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(e){i=!0,c=e}finally{try{a||null==n.return||n.return()}finally{if(i)throw c}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ve(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ve(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ve(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var $e=function(){var e=Object(a.useSelector)(_),t=Object(s.f)(),n=Ke(Object(r.useState)(!1),2),c=n[0],o=n[1],i=Ke(Object(r.useState)(""),2),u=i[0],l=i[1],f=Ke(Object(r.useState)(""),2),d=f[0],p=f[1],b=Ke(Object(r.useState)(""),2),h=b[0],m=b[1],y=Ke(Object(r.useState)(""),2),j=y[0],g=y[1],O=Ke(Object(r.useState)(""),2),w=O[0],x=O[1],S=Ke(Object(r.useState)(""),2),k=S[0],A=S[1],P=Object(a.useSelector)(v),N=Object(a.useDispatch)();if(Object(r.useEffect)((function(){N(Q()),N(ee()),N(ue())}),[N]),Object(r.useEffect)((function(){null!=P&&P.full_messages?A(P.full_messages[0]):A(P)}),[P]),Object(r.useEffect)((function(){A("")}),[u,d,h,j,w,c]),Object(r.useEffect)((function(){e.isSignedIn&&!e.isLoading&&t.replace("/")}),[e,t]),e.isLoading||!e.hasVerificationBeenAttempted)return Object(Ue.jsx)("div",{children:"Loading..."});var E,I=function(e){if(!function(e){return/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())}(u))return A("Bad email format!"),!1;if(j.length<6)return A("Password must be 6 symbols or longer"),!1;if(e){if(!d)return A("Name can't be blank!"),!1;if(!h)return A("Nickname can't be blank!"),!1;if(j!==w)return A("Passwords don't match!"),!1}return!0};return E=c?Object(Ue.jsxs)("div",{className:"panel sign-up",children:[Object(Ue.jsx)("img",{src:"./images/rubygram.png",alt:"Rubygram",className:"logo"}),Object(Ue.jsx)("div",{className:"panel-title",children:"Sign up"}),Object(Ue.jsx)(Fe,{type:"text",label:"E-mail",onChange:function(e){return l(e.currentTarget.value)},value:u}),Object(Ue.jsx)(Fe,{type:"text",label:"Name",onChange:function(e){return p(e.currentTarget.value)},value:d}),Object(Ue.jsx)(Fe,{type:"text",label:"Nickname",onChange:function(e){return m(e.currentTarget.value)},value:h}),Object(Ue.jsx)(Fe,{type:"password",label:"Password",onChange:function(e){return g(e.currentTarget.value)},value:j}),Object(Ue.jsx)(Fe,{type:"password",label:"Confirm Password",onChange:function(e){return x(e.currentTarget.value)},value:w}),k&&Object(Ue.jsx)("div",{className:"error",children:k}),Object(Ue.jsx)(Qe,{onClick:function(){return I(!0)&&function(){return C.registerUser.apply(C,arguments)(fe.dispatch)}({email:u,name:d,password:j,passwordConfirmation:w,nickname:h}).then((function(){return console.log("Signed up")}))},children:"Sign up"}),Object(Ue.jsx)(Qe,{flat:!0,onClick:function(){return o(!1)},children:"Already registered?"})]}):Object(Ue.jsxs)("div",{className:"panel sign-in",children:[Object(Ue.jsx)("img",{src:"./images/rubygram.png",alt:"Rubygram",className:"logo"}),Object(Ue.jsx)("div",{className:"panel-title",children:"Sign in"}),Object(Ue.jsx)(Fe,{type:"email",label:"E-mail",onChange:function(e){return l(e.currentTarget.value)},value:u}),Object(Ue.jsx)(Fe,{type:"password",label:"Password",onChange:function(e){return g(e.currentTarget.value)},value:j}),k&&Object(Ue.jsx)("div",{className:"error",children:k}),Object(Ue.jsx)(Qe,{onClick:function(){return I()&&function(){return C.signInUser.apply(C,arguments)(fe.dispatch)}({email:u,password:j}).then((function(){return console.log("Logged in")}))},children:"Sign in"}),Object(Ue.jsx)(Qe,{flat:!0,className:"sign-up",onClick:function(){return o(!0)},children:"Sign up"})]}),Object(Ue.jsx)("div",{className:"login",children:E})},We=(n(385),n(387),["#cc90e2","#80d066","#ecd074","#6fb1e4","#e57979","#f98bae","#73cdd0","#fba76f"]),ze=function(e){var t=e.user,n=t.image;return Object(Ue.jsx)("div",{className:"user-avatar",style:{backgroundColor:We[t.id%We.length]},children:n?Object(Ue.jsx)("img",{src:n,alt:"".concat(t.name," avatar"),className:"avatar-image"}):Object(Ue.jsx)("div",{className:"avatar-text",children:(t.name||"???").slice(0,2)})})},Je=function(e){var t=e.peer,n=e.action;return Object(Ue.jsxs)("div",{className:"chat-header",children:[Object(Ue.jsx)(ze,{user:t}),Object(Ue.jsxs)("div",{className:"info",children:[Object(Ue.jsx)("div",{className:"name",children:t.name||"???"}),!n&&t.nickname&&Object(Ue.jsx)("div",{className:"nickname",children:"@".concat(t.nickname)}),n&&Object(Ue.jsx)("div",{className:"action loading-text",children:n})]})]})},Ze=n(157);n(389);function Ge(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null==n)return;var r,c,o=[],a=!0,i=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(e){i=!0,c=e}finally{try{a||null==n.return||n.return()}finally{if(i)throw c}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return He(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return He(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function He(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Xe(e,t,n){Te.messages.sendMessage(e.id,t),n("")}var Ye=function(){var e=Object(a.useSelector)(K),t=Ge(Object(r.useState)(""),2),n=t[0],c=t[1],o=Object(r.useRef)();Object(r.useEffect)((function(){c("")}),[e.id]);return Object(Ue.jsxs)("div",{className:"chat-input-wrapper",children:[Object(Ue.jsx)("div",{className:"chat-input",children:Object(Ue.jsx)("div",{className:"chat-input-scroll-wrapper",children:Object(Ue.jsx)(Ze.a,{autoFocus:!0,minRows:3,className:"text-area",placeholder:"Enter message...",onChange:function(t){c(t.currentTarget.value),(!o.current||o.current+3e3<Date.now())&&(Te.chats.sendTyping(e.id),o.current=Date.now())},value:n,onKeyPress:function(t){"Enter"===t.key&&(t.ctrlKey||t.shiftKey||(Xe(e,n,c),t.preventDefault()))}})})}),Object(Ue.jsx)("button",{className:"send",onClick:function(){return Xe(e,n,c)},children:"Send"})]})},et={hour:"2-digit",minute:"2-digit"},tt={year:"2-digit",month:"2-digit",day:"2-digit"};function nt(e){var t=Date.now()/1e3,n=e.getTime()/1e3,r=et;return Math.abs(t-n)>86400&&(r=tt),new Date(1e3*n).toLocaleString(window.navigator.language,r)}n(391);var rt=function(e){var t=e.chat,n=e.user,r=e.selected,c=Object(s.f)(),o=t.recipient_id===n.id?t.sender:t.recipient,a=new Date(t.last_at),i=t.action||t.preview;return Object(Ue.jsxs)("div",{className:"chat-list-item ".concat(r?"selected":""),onClick:function(){c.replace("?peer=".concat(o.id))},children:[Object(Ue.jsx)(ze,{user:o}),Object(Ue.jsxs)("div",{className:"info",children:[Object(Ue.jsxs)("div",{className:"top-line",children:[Object(Ue.jsx)("div",{className:"name",children:o.name||"???"}),Object(Ue.jsx)("div",{className:"time",children:nt(a)})]}),Object(Ue.jsx)("div",{className:Me()({"chat-preview":!0,"loading-text":t.action}),children:i})]})]})},ct=function(){var e=Object(a.useSelector)(ce),t=Object(a.useSelector)(_),n=Object(a.useSelector)(K);return Object(r.useEffect)((function(){Te.chats.requestAllChats()}),[]),Object(Ue.jsx)("div",{className:"chat-list",children:e.length?e.map((function(e){return Object(Ue.jsx)(rt,{chat:e,user:t,selected:n&&n.id===(t.id===e.recipient_id?e.sender_id:e.recipient_id)},e.id)})):"No chats!"})},ot=(n(393),function(e){var t=e.message,n=Object(a.useSelector)(_),r=t.user.id===n.id,c=Me()({"message-wrapper":!0,right:r,left:!r});return Object(Ue.jsxs)("div",{className:c,children:[!r&&Object(Ue.jsx)(ze,{user:t.user}),Object(Ue.jsxs)("div",{className:"message",children:[!r&&Object(Ue.jsx)("div",{className:"name",children:t.user.name}),Object(Ue.jsx)("div",{className:"text",children:t.body}),Object(Ue.jsx)("div",{className:"time",children:new Date(t.updated_at).toLocaleString(window.navigator.language,et)})]})]})}),at=function(){var e=Object(a.useSelector)(V),t=Object(r.useRef)();return Object(r.useEffect)((function(){t.current.scrollIntoView({behavior:"smooth"})}),[e]),Object(Ue.jsxs)("div",{className:"message-container",children:[Object(Ue.jsx)("div",{className:"messages-end",ref:t}),e.map((function(e){return Object(Ue.jsx)(ot,{message:e},e.id)})).reverse()]})},it=function(e){var t=e.user,n=Object(s.f)();return Object(Ue.jsx)("div",{className:"user",onClick:function(){n.replace("?peer=".concat(t.id))},children:Object(Ue.jsx)("div",{className:"name",children:t.name||"???"})})},st=function(){var e=Object(a.useSelector)(le);return Object(r.useEffect)((function(){Te.chats.requestAllUsers()}),[]),Object(Ue.jsxs)("div",{className:"user-list",children:[Object(Ue.jsx)("h2",{children:"All users in the system:"}),e.length?e.map((function(e){return Object(Ue.jsx)(it,{user:e},e.id)})):"No users! :O"]})},ut=(n(395),function(e){var t=e.user;return Object(Ue.jsxs)("div",{className:"user-panel",children:[Object(Ue.jsxs)("div",{className:"current-user",children:[Object(Ue.jsx)(ze,{user:t}),Object(Ue.jsxs)("div",{className:"info",children:[Object(Ue.jsx)("div",{className:"name",children:t.name||"???"}),t.nickname&&Object(Ue.jsx)("div",{className:"nickname",children:"@".concat(t.nickname)})]})]}),Object(Ue.jsx)("div",{className:"actions",children:Object(Ue.jsx)("button",{onClick:function(){(function(){return C.signOutUser.apply(C,arguments)(fe.dispatch)})().catch((function(e){return console.log(e)}))},children:"Log out"})})]})});var lt=function(){var e=Object(a.useSelector)(_),t=Object(a.useSelector)(K),n=Object(a.useSelector)($),c=Object(a.useSelector)(ce),o=Object(s.f)(),i=c.find((function(e){return e.id===n})),u=Object.fromEntries(new URLSearchParams(Object(s.g)().search)).peer;return Object(r.useEffect)((function(){Number.parseInt(u)&&(null==t?void 0:t.id)!==+u?Te.chats.requestChat(+u):o.replace("?")}),[u]),Object(Ue.jsxs)("div",{className:"messenger",children:[Object(Ue.jsxs)("div",{className:"left-bar",children:[Object(Ue.jsx)(ut,{user:e}),Object(Ue.jsx)(ct,{}),Object(Ue.jsx)(st,{})]}),Object(Ue.jsx)("div",{className:"main",children:t?Object(Ue.jsxs)("div",{className:"chat",style:{backgroundImage:'url("./images/default_bg.jpg")'},children:[Object(Ue.jsx)(Je,{peer:t,action:null==i?void 0:i.action}),Object(Ue.jsx)(at,{}),Object(Ue.jsx)(Ye,{})]}):Object(Ue.jsx)("div",{className:"select-chat",children:Object(Ue.jsx)("div",{className:"select-chat-message",children:"Select chat"})})})]})};function ft(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function dt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ft(Object(n),!0).forEach((function(t){pt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ft(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function pt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var bt="/login";function ht(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),c=1;c<t;c++)n[c-1]=arguments[c];return function(t){var c=t.history,o=Object(a.useSelector)(P),i=Object(a.useSelector)(N);return Object(r.useEffect)((function(){i&&!o&&c.replace(bt)}),[o,i,c]),i&&o?Object(Ue.jsx)(e,dt({},n)):Object(Ue.jsx)("div",{children:"Logging in..."})}}console.log("Running in ".concat("production"," mode"));var mt=function(){return Object(r.useEffect)((function(){Te.init(),A(fe),fe.subscribe((function(){E=_(fe.getState())}))}),[]),Object(Ue.jsx)(i.a,{children:Object(Ue.jsxs)(s.c,{children:[Object(Ue.jsx)(s.a,{exact:!0,path:"/",component:ht(lt)}),Object(Ue.jsx)(s.a,{path:"/login",component:$e})]})})};n(397);o.a.render(Object(Ue.jsx)(a.Provider,{store:fe,children:Object(Ue.jsx)(mt,{})}),document.getElementById("App")),"serviceWorker"in navigator&&window.addEventListener("load",(function(){navigator.serviceWorker.register("./service-worker.js").then((function(e){})).catch((function(e){console.log("SW registration failed: ",e)}))}))}});